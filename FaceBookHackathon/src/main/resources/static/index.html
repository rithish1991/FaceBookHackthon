<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBOT</title>

    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700);

        * {
            box-sizing: border-box;
        }

        html {
            background: rgba(0, 0, 0, 0.03);
        }

        body,
        html {
            height: 100%;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 115%;
            display: flex;
            flex-direction: column;
            max-width: 700px;
            margin: 0 auto;
        }

        .chat-output {
            flex: 1;
            padding: 20px;
            display: flex;
            background: white;
            flex-direction: column;
        }

        .chat-output>div {
            margin: 0 0 20px 0;
        }

        .chat-output .user-message .message {
            background: #0fb0df;
            color: white;
        }

        .chat-output .bot-message {
            text-align: right;
        }

        .chat-output .bot-message .message {
            background: #eee;
        }

        .chat-output .message {
            display: inline-block;
            padding: 12px 20px;
            border-radius: 10px;
        }

        .chat-input {
            padding: 20px;
            background: #eee;
            border: 1px solid #ccc;
            border-bottom: 0;
        }

        .chat-input .user-input {
            width: 100%;
            font-size: 2rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
        }
        
        //file css
        
 


        
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div class="chat-output" id="chat-output">
        <div class="user-message">
            <div class="message">Disclaimer Message. Do you want to continue?</div>
        </div>
    </div>

    <div class="chat-input">
        <form action="#0" id="user-input-form">
            <input type="text" id="user-input" class="user-input" placeholder="Talk to the bot.">
	
        </form>
    </div>

    <script>
    $(document).ready( function() {
        var outputArea = $("#chat-output");
        var challengeQuestionCount = 0;
        var confidenceMeter = 0;

        $("#user-input-form").on("submit", function (e) {
        	 e.preventDefault();
           if(challengeQuestionCount == 0)
        	{
            $("#user-input").attr("disabled", true);
            var message = $("#user-input").val();
            $("#user-input").val("");
            outputArea.append(`
                <div class='bot-message'>
                <div class='message'>
                    ${message}
                </div>
                </div>
            `);

           
    
             

	$.ajax({
    url: 'https://still-shore-09941.herokuapp.com/yesno',
    headers: {
        'Content-Type': 'application/json',
	
    },
    type: "POST", /* or type:"GET" or type:"PUT" */
    dataType: "json",
     crossDomain: true,
    data: JSON.stringify({"text":message }),
	success: function (result) {
		
		console.log(result);
		var data = result.yesOrNo;
		var confidence = result.confidence;
		
		if(confidence == "NA" || confidence <0.5 )
		{
		
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
                Please be more specific on feedback
                </div>
                </div>
            `);
		$("#user-input").attr("disabled", false);
		}
		
		else if(data === "Yes") 
			{
			
			
			 outputArea.append(`
		                <div class='user-message'>
		                <div class='message'>
		                Are you ready for the challenge 1!!!?
		                </div>
		                </div>
		            `);
			 
			 challengeQuestionCount++;
			 $("#user-input").attr("disabled", false);
			
			}
		else if(data === "No")
			{
			
			 outputArea.append(`
		                <div class='user-message'>
		                <div class='message'>
		                Your Welcome  Kindly close the browser
		                </div>
		                </div>
		            `);
			}
		else
			{
			 $("#user-input").attr("disabled", false);
			outputArea.append(`
	                <div class='user-message'>
	                <div class='message'>
	                Please be more specific on feedback
	                </div>
	                </div>
	            `);
			}

    },
    error: function () {
        alert("error");
    }
})

     }	//question  discalaimaer

     
     
     	//Question 1
           if(challengeQuestionCount == 1)
      	 	{
           $("#user-input").attr("disabled", true);
           var message = $("#user-input").val();
           $("#user-input").val("");
           outputArea.append(`
               <div class='bot-message'>
               <div class='message'>
                   ${message}
               </div>
               </div>
           `);

          
   
            

	$.ajax({
   url: 'https://still-shore-09941.herokuapp.com/yesno',
   headers: {
       'Content-Type': 'application/json',
	
   },
   type: "POST", /* or type:"GET" or type:"PUT" */
   dataType: "json",
    crossDomain: true,
   data: JSON.stringify({"text":message }),
	success: function (result) {
		
		console.log(result);
		var data = result.yesOrNo;
		var confidence = result.confidence;
		
		if(confidence == "NA" || confidence <0.5 )
		{
		
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
                Please be more specific on feedback
                </div>
                </div>
            `);
		$("#user-input").attr("disabled", false);
		}
		else if(data === "Yes") 
			{
			
			
			outputArea.append(`
	                <div class='user-message'>
					
	                <div class='message'>
	                “When you arise in the morning, think of what a precious privilege it is to be alive-to breathe, to think, to enjoy, to love.” -Marcus Aurelius
	                <br/><br/>
	                Take a selfie early in the morning with a Tea/Coffee having sun at the background
	                </div>
	                <br/><br/>
					<div>
					  <input type="file" id="fileUploadchallengeOne" accept="image/x-png,image/gif,image/jpeg" style="display:none;"> 
					  <button id="buttonChallengeOne">Upload Selfie with sunshine</button>  
					  <span id="fileName"></span>
					</div>
	                </div>
	            `);
			 
			
			
			}
		else if(data === "No")
			{
			
			 outputArea.append(`
		                <div class='user-message'>
		                <div class='message'>
		                Your Welcome  Kindly close the browser
		                </div>
		                </div>
		            `);
			}
		else
			{
			 $("#user-input").attr("disabled", false);
			outputArea.append(`
	                <div class='user-message'>
	                <div class='message'>
	                Please be more specific on feedback
	                </div>
	                </div>
	            `);
			}

   },
   error: function () {
       alert("error");
   }
})

    }	//question  one

  //Question 2
    if(challengeQuestionCount == 2)
	 {
    $("#user-input").attr("disabled", true);
    var message = $("#user-input").val();
    $("#user-input").val("");
    outputArea.append(`
        <div class='bot-message'>
        <div class='message'>
            ${message}
        </div>
        </div>
    `);

   

     

$.ajax({
url: 'https://still-shore-09941.herokuapp.com/sentiment',
headers: {
'Content-Type': 'application/json',

},
type: "POST", /* or type:"GET" or type:"PUT" */
dataType: "json",
crossDomain: true,
data: JSON.stringify({"text":message }),
success: function (result) {
	
	console.log(result);
	var confidence = result.confidence;
	var sentiment  = result.sentiment;
	if(confidence == "N/A" || confidence <0.5 )
		{
		
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
                Please be more specific on feedback
                </div>
                </div>
            `);
		$("#user-input").attr("disabled", false);
		}
	else if(sentiment =="positive")
		{
		confidenceMeter +=3;
		challengeQuestionCount++;
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
               Are you excited to take second challenge!!?
                </div>
                </div>
            `);
		$("#user-input").attr("disabled", false);
		
		
		}
	else if(sentiment =="negative")
		{
		confidenceMeter +=1;
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
             Sorry if you didn't like the previous challenge. 	
             We will try to bring more interesting challenges  
                </div>
                </div>
            `);
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
               Are you excited to take second challenge!!?
                </div>
                </div>
            `);
		}
	else if(sentiment == "neutral")
		{
		confidenceMeter +=2;
		challengeQuestionCount++;
		outputArea.append(`
                <div class='user-message'>
                <div class='message'>
               Are you excited to take second challenge!!?
                </div>
                </div>
            `);
		$("#user-input").attr("disabled", false);
		}
	console.log(confidenceMeter);

},
error: function () {
alert("error");
}
})

}	//question  two   

    
    
    
   
        });
        $(document).on("click", "#buttonChallengeOne" , function() {
        
        
        	
            $("#fileUploadchallengeOne").click();
          });
        $(document).on("change", "#fileUploadchallengeOne" , function() {
       
      
        	
        	 var fileName = $('#fileUploadchallengeOne')[0].files[0].name;
             var idxDot = fileName.lastIndexOf(".") + 1;
             var extFile = fileName.substr(idxDot, fileName.length).toLowerCase();
          
             
             var formData = new FormData();
             formData.append('file', $('#fileUploadchallengeOne')[0].files[0]);
             
             if (extFile=="jpg" || extFile=="jpeg" || extFile=="png"){
            	 
            	 $.ajax({
            		    url: "/upload",
            		    type: "POST",
            		    data:formData ,
            		   
            		    processData: false,
            		    contentType: false,
            		    cache: false,
            		    success: function () {
            		      // Handle upload success
            		      // ...
            		    },
            		    error: function () {
            		      // Handle upload error
            		      // ...
            		    }
            		  });
            	 
            	 
            	 
            	 challengeQuestionCount++;
           	  $("#buttonChallengeOne").attr("disabled", true);
    			 outputArea.append(`
   		                <div class='user-message'>
    					<div class='message'>
   		              Uploaded succesfully
   		                </div>
    			 			<br/><br/>
   		                <div class='message'>
   		               What do you feel about challenge 1!!? ,Did you like the challenge!!? 
   		                </div>
   		                </div>
   		            `);
    			 $("#user-input").attr("disabled", false);
            	 
    			 
    			 

                
             }else{
                 alert("Only Images files are allowed!");
             }   
        	
        	
        	  //$('#fileName').text($('#fileUploadchallengeOne')[0].files[0].name);
        	 
 			
        	  
        	});
    }); 
    </script>
</body>

</html>